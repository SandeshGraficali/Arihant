﻿
@model IEnumerable<Arihant.Models.Company_Master.CompanyProfileModel>

<head>
    <link href="~/css/datatables.css" rel="stylesheet" />
    <link href="~/css/allmin.css" rel="stylesheet" />
    <link href="~/css/toggle.min.css" rel="stylesheet" />

    <link href="~/css/sumoselect.css" rel="stylesheet" />

</head>
<style>
  
</style>
<body class="bg">
    <div class="wrapper paddingLR10">
        <div class="col-lg-12 padding10 Heading FontColor1 AllCaps" style="display: flex; justify-content: space-between; align-items: center;">

            <div style="flex: 1;"></div>

            <div style="flex: 2; text-align: center;">
                <strong>Company List</strong>
            </div>

            <div style="flex: 1; text-align: right;">
                <a href="@Url.Action("CompanyMaster", "Users_Master")" class="Button ButtonColor1 BorderRounded5" style="text-decoration:none; padding: 8px 15px; display: inline-flex; align-items: center; gap: 5px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-circle-fill" viewBox="0 0 16 16">
                        <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z" />
                    </svg>
                    Add New Company
                </a>
            </div>
        </div>
        <div class="col-lg-12 floatleft BgColor1 Border1 BorderColor1 padding20 BorderRounded10 Shadow">
            <table id="companyTable" class="TableStyle1">
                <thead class="BgColor1 FontColor1">
                    <tr>
                        <th>Company Name</th>
                        <th>GST No.</th>
                      
                        <th>Email</th>
                        <th>WebSite</th>
                        <th>Mobile Number</th>
                        <th>IsActive</th>
                        <th style="width:100px;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.CompanyName</td>
                            <td>@item.GSTNo</td>
                        
                            <td>@item.Email</td>
                            <td>@item.Website</td>
                            <td>@item.MobileNumber</td>
                            <td>
                       
                                <div class="status-toggle" style="cursor:pointer;" onclick="ToggleStatus(@item.CompanyID, this)">
                                    @if (item.IsActive == "1")
                                    {
                                        <img src="~/images/4-active.png" id="img_@item.CompanyID" data-status="1" style="width:55px;" alt="Active" />
                                    }
                                    else
                                    {
                                        <img src="~/images/4-inactive.png" id="img_@item.CompanyID" data-status="0" style="width:55px;" alt="Inactive" />
                                    }
                                </div>
                            </td>
                            <td>
                                
                             

                                <div style="display: flex; gap: 10px; align-items: center;">
                                 
                                    <a href="@Url.Action("EditCompany", "Users_Master", new { id = item.CompanyID })" title="Edit">
                                        <img src="~/images/edit.png" alt="Edit" style="width:20px; height:20px; cursor:pointer;" />
                                    </a>

                           
                                    <a href="javascript:void(0)" onclick="DeleteCompany(@item.CompanyID)" title="Delete">
                                        <img src="~/images/delete.png" alt="Delete" style="width:20px; height:20px; cursor:pointer;" />
                                    </a>
                                </div>

                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</body>

<script src="~/js/jquery-3.7.1.js"></script>
<script src="~/js/sumoselect.js"></script>
<script src="~/js/datatables.js"></script>
<script src="~/js/sweetalert2.js"></script>
<script src="~/js/validation.js"></script>

<script>
      $.fn.dataTable.ext.errMode = 'none';

    $(document).ready(function () {
         
          $('#companyTable').DataTable();
      });

             function DeleteCompany(id) {
        Swal.fire({
            title: 'Are you sure?',
            text: "Do you want to deactivate this company?",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Yes, deactivate it!'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: '@Url.Action("DeleteCompany", "Users_Master")',
                    type: 'POST',
                    data: { CompanyID: id },
                    success: function (response) {
                        if (response.success) {
                         
                            Swal.fire({
                                title: 'Deactivated!',
                                text: response.message,
                                icon: 'success',
                                confirmButtonColor: '#3085d6'
                            }).then(() => {
                                
                                location.reload();
                            });
                        } else {
                            
                            Swal.fire({
                                title: 'Failed!',
                                text: response.message,
                                icon: 'error',
                                confirmButtonColor: '#d33'
                            });
                        }
                    },
                    error: function (xhr, status, error) {
                        Swal.fire({
                            title: 'Error!',
                            text: 'An error occurred while communicating with the server.',
                            icon: 'error'
                        });
                    }
                });
            }
        });
    }
               function ToggleStatus(id, container) {
     
        const img = $(container).find('img');
        const currentStatus = img.attr('data-status'); 
        const isActivating = (currentStatus === "0");

        const actionText = isActivating ? "Activate" : "Deactivate";

        Swal.fire({
            title: 'Are you sure?',
            text: `Do you want to ${actionText} this company?`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, change it!'
        }).then((result) => {
            if (result.isConfirmed) {
               
                $.ajax({
                  url: '@Url.Action("UpdateStatus", "Users_Master")',
                    type: 'POST',
                   
                    data: { id: id, status: isActivating ? "1" : "0" },
                    success: function (response) {
                        if (response.success || response === "1") {
                            Swal.fire('Success!', 'Status updated successfully.', 'success');

                            if (isActivating) {
                                img.attr('src', '/images/4-active.png');
                                img.attr('data-status', "1");
                            } else {
                                img.attr('src', '/images/4-inactive.png');
                                img.attr('data-status', "0");
                            }
                        } else {
                            Swal.fire('Error!', 'Could not update status.', 'error');
                        }
                    },
                    error: function () {
                        Swal.fire('Error!', 'Could not connect to the server.', 'error');
                    }
                });
            }
        });
    }
</script>