@using Arihant.Models.IP_Master

@{
    ViewData["Title"] = "Customer List";
}
@model List<IP_Master_Model>
<link href="~/css/datatables.css" rel="stylesheet" />
<link href="~/css/allmin.css" rel="stylesheet" />
<link href="~/css/toggle.min.css" rel="stylesheet" />

<link href="~/css/sumoselect.css" rel="stylesheet" />
<style>

    .table-wrapper {
        margin: 50px auto;
        max-width: 95%;
        padding: 20px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }

    .custom-modal-overlay {
        display: none;
        position: fixed;
        z-index: 9999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
    }


    .custom-modal-content {
        background-color: #fff;
        margin: 5% auto;
        padding: 20px;
        border-radius: 8px;
        width: 400px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        position: relative;
    }

    .modal-header-custom {
        border-bottom: 1px solid #ddd;
        padding-bottom: 10px;
        margin-bottom: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .form-group {
        margin-bottom: 15px;
    }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

    .error-msg {
        color: red;
        font-size: 12px;
        display: none;
    }

    input.error {
        border-color: red;
    }

    .action-bar {
        display: flex;
        justify-content: flex-end;
        margin-bottom: 15px;
        max-width: 95%;
        margin-left: auto;
        margin-right: auto;
    }

    .btn-add-user {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        font-weight: bold;
        cursor: pointer;
        transition: background 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }

        .btn-add-user:hover {
            background-color: #0056b3;
        }


    .table-wrapper {
        margin-top: 10px;
    }

    /* Add this to your <style> tag */
    .SumoSelect {
        width: 100%;
    }

        .SumoSelect > .caption {
            border-radius: 4px;
            height: 38px;
            padding-top: 8px;
        }

        .SumoSelect > .optWrapper > .options li.opt label {
            margin-bottom: 0; /* Fixes checkbox alignment */
        }

    /* Modal Overlay */
    .custom-modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.6);
        z-index: 9999;
    }

    /* Modal Content Box */
    .custom-modal-content {
        background: #fff;
        width: 450px;
        margin: 50px auto;
        padding: 0;
        border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        position: relative;
        font-family: Arial, sans-serif;
    }

    .modal-header-custom {
        background: #0b50a6;
        color: white;
        padding: 15px;
        border-radius: 8px 8px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .form-group {
        margin: 15px;
    }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input, .form-group select {
            width: 93%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

    /* SVG Icon Button Styles */
    .btn-icon {
        background: none;
        border: none;
        cursor: pointer;
        padding: 5px;
        transition: transform 0.2s;
    }

        .btn-icon:hover {
            transform: scale(1.1);
        }

    .error-msg {
        color: red;
        font-size: 11px;
        display: none;
    }

</style>

<div id="ipModal" class="custom-modal-overlay">
    <div class="custom-modal-content">
        <div class="modal-header-custom">
            <h3 id="modalTitle">IP Address</h3>
            <button onclick="CloseModal()" style="background:none; border:none; color:white; cursor:pointer; font-size:20px;">&times;</button>
        </div>

        <input type="hidden" id="txtID" />

        <div class="form-group">
            <label>IP Address</label>
            <input type="text" id="txtIPAdd" placeholder="192.168.1.1" />
            <span id="errIP" class="error-msg">Required</span>
        </div>

        <div class="form-group">
            <label>Name</label>
            <input type="text" id="txtIPName" placeholder="Server Name" />
            <span id="errName" class="error-msg">Required</span>
        </div>

        <div style="text-align:right; padding:15px; gap: 10px; display: flex; justify-content: flex-end;">
            <button onclick="CloseModal()" style="padding:8px 15px; border-radius:4px; border:1px solid #ccc; cursor:pointer;">Cancel</button>

            <button id="btnAddSubmit" onclick="SaveNewIP()" style="display:none; padding:8px 15px; border-radius:4px; border:none; background:#28a745; color:white; cursor:pointer;">Save New IP</button>
            <button id="btnUpdateSubmit" onclick="UpdateExistingIP()" style="display:none; padding:8px 15px; border-radius:4px; border:none; background:#0b50a6; color:white; cursor:pointer;">Update Changes</button>
        </div>
    </div>
</div>

<div class="container">
    <div class="table-wrapper">
        <div class="action-bar">
            <button id="btnOpenModal" class="btn-add-user" onclick="OpenAddModal()">
                <i class="fas fa-plus"></i> Add IP
            </button>
        </div>
        <h2 class="text-center">IP Master List</h2>
        <table id="IPList" class="TableStyle1" style="width:100%">
            <thead>
                <tr>
                    <th>#</th>
                    <th>IP Address</th>
                    <th>Name</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null)
                {
                    int i = 1;
                    foreach (var item in Model)
                    {
                        <tr>
                            <td>@i</td>
                            <td>@item.IPAdd</td>
                            <td>@item.IP_Name</td>
                            <td style="text-align:center;">
                                <button class="btn-icon edit-btn" title="Edit"
                                        onclick="EditIP('@item.ID', '@item.IPAdd', '@item.IP_Name')">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                                </button>
                                <button class="btn-icon delete-btn" title="Delete" onclick="DeleteIP('@item.ID')">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="red" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                </button>
                            </td>
                        </tr>
                        i++;
                    }
                }
            </tbody>
        </table>
    </div>
</div>
<script src="~/js/jquery-3.7.1.js"></script>
<script src="~/js/sumoselect.js"></script>
<script src="~/js/datatables.js"></script>
<script src="~/js/sweetalert2.js"></script>
<script src="~/js/validation.js"></script>
<script>
            $.fn.dataTable.ext.errMode = 'none';

     function OpenAddModal() {
        $('#modalTitle').text("Add New IP Address");
        $('#txtID').val("");
        $('#txtIPAdd').val("");
        $('#txtIPName').val("");

        // UI Management: Show Add button, Hide Update button
        $('#btnUpdateSubmit').hide();
        $('#btnAddSubmit').show();

        $('#ipModal').fadeIn(300); // jQuery show with animation
    }
       function SaveNewIP() {
        var model = {
             ID: '',
            IPAdd: $('#txtIPAdd').val().trim(),
            IP_Name: $('#txtIPName').val().trim()
        };

        if (model.IPAdd === "" || model.IP_Name === "") {
            Swal.fire("Warning", "Please enter both IP and Name", "warning");
            return;
        }

        $.post("@Url.Action("AddIPMaster", "Users_Master")", model, function (res) {
            if (res.success) {
                CloseModal();
                Swal.fire("Success", "New IP saved successfully!", "success").then(() => {
                    location.reload();
                });
            } else {
                  CloseModal();
                Swal.fire("Error", res.message || "Failed to add", "error");
            }
        });
    }

                function OpenModal() {
        $('#modalTitle').text("Add IP Address");
        $('#txtID').val("");
        $('#txtIPAdd').val("");
        $('#txtIPName').val("");
        $('#ipModal').fadeIn(300); 
        $('#btnSaveAdd').hide();
      $('#btnSaveUpdate').show();
       
    }

        function CloseModal() {
        $('#ipModal').fadeOut(200); // jQuery hide with animation
    }
    function EditIP(id, ip, name) {
        $('#modalTitle').text("Edit IP Address");
        $('#txtID').val(id);
        $('#txtIPAdd').val(ip);
        $('#txtIPName').val(name);

        // UI Management: Hide Add button, Show Update button
        $('#btnAddSubmit').hide();
        $('#btnUpdateSubmit').show();

        $('#ipModal').fadeIn(300); // jQuery show with animation
    }


      function UpdateExistingIP() {
        var model = {
            ID: $('#txtID').val(),
            IPAdd: $('#txtIPAdd').val().trim(),
            IP_Name: $('#txtIPName').val().trim()
        };

        if (model.IPAdd === "" || model.IP_Name === "") {
            Swal.fire("Warning", "Fields cannot be empty", "warning");
            return;
        }

        $.post("@Url.Action("SaveIPMaster", "Users_Master")", model, function (res) {
            if (res.success) {
                CloseModal();
                Swal.fire("Updated", "IP details updated successfully!", "success").then(() => {
                    location.reload();
                });
            } else {
                  CloseModal();
                Swal.fire("Error", res.message || "Update failed", "error");
            }
        });
    }
  
    function DeleteIP(id) {
        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.isConfirmed) {
               
                $.post("@Url.Action("DeleteIPMaster", "Users_Master")", { id: id }, function (res) {
                    if (res.success) {
                        Swal.fire("Deleted!", res.message, "success").then(() => {
                            location.reload();
                        });
                    } else {
                        Swal.fire("Error!", res.message || "Failed to delete.", "error");
                    }
                }).fail(function() {
                    Swal.fire("Error!", "Server communication failed.", "error");
                });
            }
        });
    }

    $(document).ready(function () {
       
      
        $('#IPList').DataTable({
            paging: true,
            searching: true,
            responsive: true,
                language: {
                emptyTable: "No Users Found",
                zeroRecords: "No matching records found"
            }
        });

    });
</script>
